javascript: (function() {var buttons={},new_clocks=[];function delay(e){return new Promise(t=>setTimeout(t,1e3*e))}function paint_row(e){data=(cells=e.cells)[0],color=(saldo=cells[cells.length-1].textContent.trim()).includes("-")?"table-danger":"table-success",e.classList.add(color)}function getLastCellWithTextIndex(e){let t=0;for(;t<e.length&&""!==e[t].innerHTML;)t++;return t}function addButtons(){document.getElementById("tableList").tBodies[0].rows.forEach(addButtonsToRow)}function addButtonsToRow(e){let t=Array.from(e.cells),l=t[0].innerText,n=getLastCellWithTextIndex(t)+1;if(n>10)return;let a=t.slice(2,n);buttons[l]=[],a.forEach((t,n)=>{let i=document.createElement("i");i.classList.add("bi","bi-plus-lg","text-success"),i.style.paddingRight="4px",i.style.display="inline-block";let s=n>0?a[n-1].textContent:"00:00",o=n<a.length-1?a[n].textContent:"24:00";i.onclick=()=>addClock(e,t,s,o),t.insertBefore(i,t.firstChild),buttons[l].push(i)})}function addClock(e,t,l,n){let a=e.cells[0].innerText,i=document.createElement("input");i.customDate=a,i.type="text",i.classList.add("time","mascara","text-center","form-control"),i.style.maxWidth="80px",i.placeholder="Hora",i.autocomplete="off",i.style.display="inline-block";let s=document.createElement("td");s.appendChild(i);let o=document.createElement("i");o.classList.add("bi","bi-trash3-fill","text-danger"),o.style.paddingLeft="4px",o.style.display="inline-block",o.onclick=()=>removeClock(i,e),s.appendChild(o),mdtimepicker(i,{is24hour:!0,hourPadding:!1,minTime:l,maxTime:n,events:{timeChanged:t=>updateRowCounter(e,s,t.value)}}),e.insertBefore(s,t),t==e.cells[10]?e.cells[10].remove():e.cells[9].remove(),new_clocks.push(i),removeButtons(a),addButtonsToRow(e)}function removeClock(e,t){mdtimepicker(e,"destroy");let l=new_clocks.indexOf(e);l>-1&&new_clocks.splice(l,1),e.parentElement.remove(),t.insertBefore(document.createElement("td"),t.cells[9]),removeButtons(e.customDate),addButtonsToRow(t)}function removeButtons(e){buttons.hasOwnProperty(e)&&(buttons[e].forEach(e=>e.remove()),buttons[e].length=0)}async function clockInRequest(e,t,l){console.log(e,t,l);let n=new FormData;n.set("codiSolicitudMarcatge",l),n.set("data",e),n.set("hora",t),n.set("_action_save","Crear");let a=await fetch("https://tempus.upc.edu/RLG/solicitudMarcatges/list",{method:"POST",body:n,referrer:"https://tempus.upc.edu/RLG/solicitudMarcatges/list",redirect:"manual"});return console.log(a),a.status<400}function openTabWithRequestFilled(e,t,l){let n=new URL("https://tempus.upc.edu/RLG/solicitudMarcatges/list");return n.searchParams.append("codiSolicitudMarcatge",l),n.searchParams.append("data",e),n.searchParams.append("hora",t),window.open(n,"_blank"),!0}async function clockIn(){let e=document.getElementById("codiSolicitudMarcatge").value;for(let t of new_clocks)if(!t.value){alert("Tens algun marcatge buit. Comprova-ho i torna a provar.");return}if(confirm("Per seguretat, el tempus no permet fer fitxatges des d'aquesta p\xe0gina.\nEs procedir\xe0 a obrir una p\xe0gina nova per cada fitxatge amb les dades ompler-tes per a que el facis tu mateix.\nAssegura't de permetre la p\xe0gina obrir finestres emergents abans. Si no hi ha la opci\xf3, continua normal.\nSi veus que nom\xe9s s'obre una p\xe0gina quan has fet diversos marcatges, t'hauria de sortir tamb\xe9 una icona indicant que s'han bloquejat les finestres(acostuma a estar a dreta o esquerra de la URL). Permet les finestres i torna a clicar ''Realitzar Marcatges''.")){for(let l of new_clocks){let n=l.nextSibling,a=document.createElement("i");a.classList.add("bi","bi-hourglass-top","text-warning"),a.style.paddingLeft="4px",a.style.display="inline-block",n.parentElement.replaceChild(a,n)}for(let i of new_clocks){let s=i.nextSibling,o=document.createElement("i");o.classList.add("bi","bi-hourglass-split","text-info"),o.style.paddingLeft="4px",o.style.display="inline-block",s.parentElement.replaceChild(o,s);let r=openTabWithRequestFilled(i.customDate,i.value,e);if(r){let c=document.createElement("i");c.classList.add("bi","bi-check-lg","text-success"),c.style.paddingLeft="4px",c.style.display="inline-block",o.parentElement.replaceChild(c,o)}else{let d=document.createElement("i");d.classList.add("bi","bi-x-lg","text-danger"),d.style.paddingLeft="4px",d.style.display="inline-block",o.parentElement.replaceChild(d,o)}}}}function addConfigMenu(){let e=document.getElementsByClassName("llegenda")[0];e.classList.remove("llegenda"),e.style.flex="1 1 0";let t=document.createElement("div");t.classList.add("llegenda"),t.style.display="flex",t.style.justifyContent="space-between",t.style.gap="20px;";let l=document.createElement("div"),n=document.createElement("div");n.style.flex="1 1 0",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.innerHTML="<b>Tingues en compte:</b><ul><li>El nou saldo no t\xe9 en compte el teu horari personal, pel que el saldo nou real pot no coincidir amb el mostrat.</li><li>Comprova si tens algun marcatge pendent que no estigui encara aqu\xed</li>";let a=document.createElement("label");a.for="codiSolicitudMarcatge",a.classList.add("text-left"),a.style.marginTop="10px",a.innerText="Tipus d'incid\xe8ncia";let i=document.createElement("select");i.classList.add("form-select"),i.name="codiSolicitudMarcatge",i.style.width="100%",i.title="Selecctionar tipus d'incid\xe8ncia",i.autocomplete="off",i.id="codiSolicitudMarcatge",(l=[[8006,"E/S Fora lloc habitual"],[8010,"E/S Teletreball "],[8002,"Manca de fluid el\xe8ctric"],[8004,"Oblit"],[8007,"P\xe8rdua targeta"],[8001,"Rellotge espatllat"],[8005,"Targeta espatllada"],[8008,"Targeta pendent d'alta"],]).forEach(e=>{let[t,l]=e,n=document.createElement("option");n.value=t,n.innerText=l,i.options.add(n)}),i.value=8004,n.appendChild(a),n.appendChild(i),e.parentElement.replaceChild(t,e),t.appendChild(e),t.appendChild(n);let s=document.createElement("button");s.classList.add("btn","btn-primary","rounded-pill","btnMarcatgeGreen"),s.type="button",s.onclick=clockIn;let o=document.createElement("div");o.style.display="flex",o.style.justifyContent="space-between",o.style.padding="0 15px";let r=document.createElement("img");r.src="../images/icons/computerClock1.svg",r.width="32",r.height="32",r.style.alignContent="flex-end";let c=document.createElement("p");c.classList.add("btn-green-inv-nouMarcatge"),c.style.fontSize="22px",c.style.fontWeight="500",c.innerText="Realitzar Marcatges",o.appendChild(r),o.appendChild(c),s.appendChild(o),n.appendChild(s)}function hourStringToMins(e){return 60*parseInt(e.split(":")[0])+parseInt(e.split(":")[1])}function hourDiff(e,t){return""==e||""==t?0:hourStringToMins(t)-hourStringToMins(e)}function minsToHourString(e){let t=`${Math.floor(Math.abs(e)/60)}`.padStart(2,"0"),l;return`${e<0?"-":"+"} ${t}:${`${Math.abs(e)%60}`.padStart(2,"0")}`}function computeTotalDiff(e,t){let l=hourDiff(e[0].innerText,e[1].innerText)+hourDiff(e[2].innerText,e[3].innerText)+hourDiff(e[4].innerText,e[5].innerText)+hourDiff(e[6].innerText,e[7].innerText),n;return minsToHourString(l-hourStringToMins(t.innerText))}function addNewColumn(){let e=document.getElementById("tableList"),t=document.createElement("th");t.innerText="Nou saldo",e.tHead.rows[0].appendChild(t);let l=e.tBodies[0].rows;for(let n of l){let a=document.createElement("td");n.appendChild(a)}updateNewCounters()}function updateNewCounters(){let e=document.getElementById("tableList").tBodies[0].rows;for(let t of e)updateRowCounter(t)}function updateRowCounter(e,t,l){let n=Array.from(e.cells).slice(2,10);n.indexOf(t)>-1&&(n[n.indexOf(t)]={innerText:l});let a=computeTotalDiff(n,e.cells[1]),i=e.cells[e.cells.length-1];i.innerText=a,i.classList.remove("table-danger","table-success"),i.classList.add(a.includes("-")?"table-danger":"table-success")}function modifyTitle(){document.getElementById("imatge-principal").remove(),document.getElementsByClassName("peu")[0].firstElementChild.firstElementChild.innerText+=" \xb7 Diviloper"}modifyTitle(),addButtons(),addNewColumn(),addConfigMenu();})();